接下来这个问题，你在这个项目中除了使用red is，你还知道。有没有其他的组件能完成同样的功能吗？那在这里边，我们给大家来说一说这个问题。呃，我们用的red is啊，red is它的这个主页是干什么啊？它主页是一个缓存数据库。缓存数据库。存这个k value的。一个k乘以个value啊。缓存数据库这个性能是非常好的啊，这个。

响应快，低延时。它的主页就是这个，但是它还有其他的功能，比如说red is还能实现什么功能呢？还能实现这个分布式锁啊？啊，还能实现什么？还能实现就是我们现在在这个项里边用到的它的这个。发布啊，发布。订阅功能。哎，这个发布订阅功能。啊，

我们可以订阅上几个通道channel是吧？然后呢？有人在这个channel上啊，频道上去发布消息，我们所有订阅这个channel的，这个订阅者都可以接收到这个消息。这相当于red is还提供了其他的一些功能。另外，red is在这里边呢，还提供了这个数据持久化的功能。数据持久化。就是说缓，因为它本质上数据是在缓存上存的嘛啊，它为了提高它的这个可用性啊，高可用就是即就是它出问题了它。

它数据也是能恢复的，因为它数据是可以落盘的。那在这里边注意。那我们在这里边用的这个发布定位功能，其实并非是red is的主页啊，但是red is提供了这样的一个功能。好吧啊。那你还知道其他的哪些组件可以完成同样的功能吗？实际上呢，这就是我们叫做服务器中间键啊。服务器中间键。所谓的中间件就是本身它没有办法独立完成什么功能呢？它是。呃，它必须是放在我们后端的整个服务里边，

属于整个后端，整个服务的组件之一啊，来协助我们后端真真正正的。呃，业务服务器呃，或者是日志服务器呀，等等啊，来完成一些功能的嗯。比如说像异步的发布订阅功能，对吧？那在这里边就是消息队列。实际上是专门来完成这个功能的。发布订阅啊，带有发布订阅的消息队列。而跟我们的这个red is所提供的这个发布订阅，

其实本质上啊，功能是非常类似的，但是呢，因为它是专门的消息队列，所以对于消息的这个分发消息的消费这里边。它有很多的可靠性的保证啊呃，运行呢也比较稳定。当然，对于局域网的这个消息，通信来说的话red is的发布订阅足够了，对吧啊？它的这个内存访问快低延时都是它的一些特点。那么，在这里边还有哪些呢？像卡夫卡。

是吧啊，分布式的这个呃消息队列中间键嗯。非常的这个稳定。高并发，高可用啊，俗称三高啊。那么当然，还有像这个zero mq。rabbit mq.rocket mq等等很多很多的mq啊，其实这些mq大同小异啊，都是有各种各样不同的功能，但其实本质上能叫做mq。啊，当然这个卡夫卡啊，

没有mq这个后缀是吧？卡夫卡最终出现的时候，是为了在分布式环境中进行日志收集的啊，进行一个异步的一个日志收集。性能是非常强劲的，那么其实它都有这些队列的，这个功能就是发布订阅的功能啊。你在队列订订阅了哪哪些主题啊？你在队列里边订了哪些主题topic？订订阅哪些主题啊？当这个主题上有消息发生的话呢？所有订阅这些主题的这个消费者都可以收到消息。啊，这是道理，都是同样的，

所以呢，在这里边除了red is的这个发布订阅，我们各种各样的mq也可以来完成我们这样的一个。集群的聊天服务器，跨服务器通信的这么一个功能卡夫卡就是各种各样的mq。呃，这都是可以的。OK吧啊。那么，在这里边，这是第一个问题，那么第二个问题就是我们同学啊，在这个。面试中被问到了，说是red is。

在这里边运行不稳定。啊，运行不稳定。嗯，挂了的话怎么办？好挂了的话怎么办？是不是嗯？那实际上啊，在这里边儿。首先，你要正确的看待这个问题。这个世界上没有哪个服务，说是不挂的。对不对啊？当然我们。

为了这个服务能够稳定的运行，你不可能给里边无限制的去装一些数据，我们任何服务肯定都会。配置一些跟这个服务能够正常运行的一些预值呢，比如说内存的使用量，消息的使用量啊，消息的这个存储量对吧，都会去配置一个预值的，超过这个预值的话。啊，我们直接就怎么样丢弃这些额外的处理不了的消息了，就像我们设计的一些秒杀系统的话，秒杀系统里边会产生短时间内会产生无数的订单，对吧？如果说所有订单，

我们后端服务都要进行处理的话，我们秒杀的话，后端一般都会有一个啊，这个mq像这种。呃，rabbit mq的话啊，它就非常的强劲，它的这个队列没有什么大小，只要你内存够用，它可以一直呢在内存上去放这个消息。那秒杀系统这个订单量实在是太大了，所以我们一般为了进行流量的削峰的话，一般呢也是会。规定一个上订单处理的，未处理订单的一个上限的一个，

预值了，超过这个预值的话啊，我们后续的来的订单就直接丢弃了，就不处理了。OK了吧啊，那不可能说是你是个请求过来，我就要处理那短时间高并发大流量的情况下呢，那我不能说是为了处理所有的请求，我把我自己后端的服务给搞挂了。这肯定是得不偿失了，是不是啊？所以那面试官嗯说这个ready s运行不稳定，挂的话怎么办？你不要同样的，你不要潜意识里边就认为ready s不稳定不稳定的。

是不是同学们不要总是被面试官所说的问题给带偏了啊，因为有的时候面试官可能就着你这项目，他问一问，他可能会想到的问题。实际上，他所问的问题里边很多东西他自己也并不是非常了解，因为大家以后去公司工作你就知道了，你工作以后其实你了解的就是你接触的那一细分的东西。你并不了解，对于其他你工作中经常不接触的东西，其实你并没有了解多少，除非你除工作的时间之外，你自己很用功，学了很多东西，对吧？

所以呢，red is不稳定，那你要看提供什么功能呢？对于它的本质的这个k value啊，键值这个。建建队存储的话，人家相对来说还是非常的这个稳定的啊，还是非常稳定的。而且不怕数据的丢失，因为人家可以配置主从啊，配置主从呃主备服务器，然后还可以进行数据的持久化，主服务器挂了，可以切到从。啊主，

服务器恢复的话呢，可以切到主啊主备服务器呢啊，可以进行那个数据同步啊，可以进行数据同步。嗯，那么如果说是用他的发布订阅功能的话，那red is确因为这不是他的主页嘛，包括用的这个分布式锁啊red is也经常会出现问题，导致这个分布式锁无法释放，导致集群环境。分布式集群环境中啊，这个不同一个机器占用了这个分布呃，分布式锁其他的机器呢啊，这个获取不到这个分布式锁，所以一般。

在实际的使用中，会嗯会去想一些策略，或者说是我们不用red is的分布式锁，用其他的方式啊。更稳定的一种方式，那么发布订阅也是在之前的red is版本里边啊，对于发布订阅来说呢？他其实呢，red is并没有一个发布订阅消息的控制，如果说red is里边的这个消息啊。red is里边消息。积累的。过快，而我们应用端呢？消费。

消费啊，消费消息过慢。啊，过慢是不是意味着red is里边消息攒得快？而我们这里边消息消费的慢，就导致red is里边消息越攒越多，越攒越多，越攒越多，但之前呢？red is。这一块呢，就可能会导致消息，如果积累的过多的话，会直接导致red is的整个服务就挂掉了，或者说是。

linux呢，因为占用的这个内存过多linux，就直接把red is这个进程就直接给杀掉了，导致呢它不稳定，导致我们。那这个red is服务一挂的话，肯定就导致整个的这个跨服务器通信就没有办法聊天啦，是不是啊？那确实会存在这样的一个问题。那么，在这里边，还有就是因为red is它。嗯，他的这个主页不是发布订阅，所以他在消息的消费这块也有一些问题。

啊，首先呢，你看。消息的这个。这个发布。首先我要往一个channel上去发布一个消息，但是现在没有人在这个channel上去监听这个消息的话，那在red is里边。啊，发布这个消息，往一个channel上发布这个消息的话，这个消息相当于就丢了。没有人去订阅这个消息。另外的话就是消息的消费。消息的消费啊，

它不可靠。还是那句话，因为它主页不是发布订阅啊，所以呢，当我们当我们在这里边啊，在这个red is里边的某一个channel上。订阅了一个消息。是吧啊，订阅了消息。那么有。消息的发布方在这个channel上发布了消息。订阅了消息。这个是发布了消息啊。那这个发布消息以后呢？这个red is就会给我们订阅了消息的，

这个订阅方。会转发这个消息，它其实呢，就只管发送。它只管发送。也就是说跟我们前边说的一样，这red is里边的channel在进行消息发送以后呢，他就不管了，剩下的事情他就不管了，就是没有做消息的可靠传输。没有做消息的，一定一这个呃，一发一答啊，一发一答就是呃发送，然后接受应答。

OK吧，那如果说是由于网络的情况发送出去的消息呢，导致最终没有到达我这个消费方，那这个消息是不是就丢了？啊，这个消息就丢了，就是消息的消费并不可靠。并不可靠。好的吧啊，所以呢，在这里边嗯red is的这个发布订阅功能，实际上它实现的还是相对来说还是比较简单的啊。在我们的这个。实际的应用中啊呃，我们如果是一个普通的一些。

非关键业务的话啊，非关键就不是核心业务，非关键业务的话，如果想用到这个基于异步的一个通知。然后一个订阅的这么一个功能，其实我们还是可以用一下red is的啊，用red is的呃如而且要。就是我们在这里边写一下啊。就是非核心业务。非核心业务啊，用到这个发布订阅功能对吧啊？另外就是。流量不是非常大。啊，就是我们那个发布的消息啊，

数量不是非常非常的大，像这种应用场景下，我们其实还是可以。用一下red is的，因为它是基于内存的低延迟消息通信快对吧啊？还是呃有一定的这个应用场景的，否则我们red is这么多年。它的发布订阅功能一直是对外正式提供的，也不是说没有任何应用的场景的啊，但是如果说我们要。依赖发布订阅实现我们核心功能，就像我们这个im聊天消息啊，那我们这个聊天肯定是我们这个即时通信软件里边最核心的业务了吧？另外呢，这个聊天消息可能随着使用的人数，

客户端越来越多，那我们这个流量也是非常大的啊，那在这种情况下，其实我们就可以采用怎么样？采用这种。哎，专业级的啊，商用级的这种消息队列来作为我们服务器的这个中间件来做来实现我们的这个m聊天软件的这个核心的业务。消息传输。首先呢，这是我们刚说过的，像这些这个。像这些啊，这个消息队列，首先呢，

它是。运行一，运行稳定二，本身就是高并发场景下应用的，对吧啊三在这里边呢，他对于消息的发布跟消息的消费都有一些可靠性的一些机制。首先，消息的发布，当你向某一个主题发布一个消息的话，如果没有人订阅这个主题，这个消息是会缓存到这个消息堆列里边，而不是直接就扔掉了，像red is这样。OK吧，另外呢，

消息的消费在这里边啊，有人这个有发布者向这个主题发布了一个消息啊。如果说是啊，如果说是有人订阅了这个主题要消费这个消息，那么消息队列在这里边会有一个可靠的消息机制。它保证这个消息一定是要被你消费到了，就是相当于有这个一应一答的过程。OK吧啊，如果呢，这个消息没有被你消费的话，那么重，这个mq会重新的去给你推送这个消息呢？好了吧啊，注意一下啊。所以不管是消息的发布还是消息的消费呢，

他都是。可靠的啊，它都是可靠的。另外，在这个稳定性以及这个并发能力上，因为这些m队呃m ql是一个消息队列，本身它的这个主页。就是完成啊，这个消息基于队列的消息通讯相当于这个发布订阅功能的一个消息通讯的，所以它整个的这个稳定性啊以及。性能是非常不错的，而且这些mq啊呃，基本上也都是有这个数据的持久化功能的，所以。即就是这个服务挂掉的话，

消息队列里边的这个数据还是可以从啊，持久化的这个磁盘上的这个数据文件里边恢复出来的。所以我们不用担心这个数据会丢失，但是有的mq没有像这个re vit q，我记得就没有提供这个。嗯，数据的持久化还是这个zero mq这个具体的，大家可以去呃，它的官网上去查一下它提供的相应的一些功能啊。所以就是说呢，如果面试官提出这样的问题，就是项目中除了red is，你还可以使用哪些组件来完成同样的功能？而包括呢，基于我们。

当前，这个项目对于red is的应用，应用的是它的发布，订阅功能，并没有应用它的核心功能k value。当然，我们也可以在项目中应用一下它的这个核心功能k value。呃，就是。嗯，相当于把呃用户的一个登录的状态，我们登录的状态，现在是不是都写在这个数据库里边了啊？我们可以把用户的状态直接存到这个red is里边。是不是啊？

存到这个red is里边，我们一般使用red is的这个策略就是什么就是。要查用户的状态，先在red is里边查啊，查着了直接返回，查不着的话我们就去什么？诶，就去数据库里边查，查完了以后先往缓存里边一写再给数这个。服务这个呃，服务层返回是吧？继续进行业务处理啊，下一次查的时候呢，就可以在red is里边直接进行查询了。那就是这样的一个嗯，

操作的流程啊，我们也可以使用它的这个关键的这个业务啊缓存。功能好，那么针对这个问题，我们相当于给大家解答了两个问题，第一个是使用，除了使用red is。相当于还有谁能实现这个发布订阅功能，各种各样的mq啊，另外就是在使用发布订阅功能的时候，我们red is在这里边有哪些不好的地方？啊，不服务不稳定的地方啊，我们在这里边对于专门的服务器中间件mq消息队列都是可以弥补这些问题的啊。啊，

真真正正使用的时候呢，我们还是会去使用这么一个消息队列来完成同样的功能。那我们在面试的时候呢，就是。可能有些同学一些描述的问题吧啊，描述的一些问题跟面试官呢沟通有所不畅，可能导致了很多的一些误会。在这里边面试官会问我们同学的这么一个问题就是。你的这个项目为什么要用这个red is作为跨服务器？通信的这个组件啊哦，为什么这个？各个s ever啊为为什么各个s ever？不值这个。不能相互。直接进行通信呢。

啊，同学们啊。我是觉得同学们应该学着学着啊，应该有一定自己的思考对吧，哈哈。哎呀，我觉得我们有些同学呢。这个。不爱动脑子啊，不爱动脑子。其实这个问题我觉得我们上课的时候应该已经给大家说过，我们引入red is的这个原因了吧？是不是我们？为什么不让各个server直接进行通信呢？你们有很多人注册在不同的server上。

啊，那在这里边同学们啊，你这里边如果有说有六台服务器。好，我集群了六台服务器。哦，在这里边，你要服务器在进行消息，跨服务器通信的时候啊。对吧啊。你跟我还不在一个服务器上注册的，你跟我要聊天，那服务器肯定要把啊，我发的消息到我的服务器，我的服务器的消息肯定要把消息转发到是不是你的服务器上啊？

那任何服务器上的用户都可能相互进行通信的，如果我们服务器直连，那也就意味着整个的这个架构是这样的。所有的server又要当客户端，又要当服务器啊，同学们，整个的这个网络拓扑结构就成这个样子了。哇，同学们，这个设计你觉得如何？这个设计不好吧？是不是不好啊？因为在这里边，首先所有所有的服务器不仅仅要当服务器，还要当客户端跟。

别的所有的其他服务器里，这就造成了一个很大的问题，就是服务器跟服务器之间偶合性太高了。再者，你为了检测其他服务器啊，是否在线状态是否正常，你还得不断的跟其他的服务器是不是保持一个心跳啊？就是我们前面说的，因为你要真真正正使用。啊，你要肯定要引入心跳的机制，看他在不在？当我们在这里边，由于一台服务器产生故障了。那么，

其他所有的服务器会发很大的力气呢？去跟他维持这个心跳，心跳维持不住了，是不是要拆除这个连接啊啊？当我们再去增加一个心跳的呃。的再增加一个服务器的话，那在这里边。我再增加了一台服务器。我还要想办法让所有的服务器去连接这台服务器，然后这台服务器要作为这个客户端连接所有的其他的服务器。哇，同学们啊，没有人的服务端集群，这个服务器是这样设计的好吧啊，如果这样的设计好的话，

那我们这个是那我们后团的这个。后端的开发的这个软件设计上就没有什么所谓的服务器，中间件的这个产生的这个啊。产生的必要了呃，就没有必要要他们这样的业务实现，肯定是问题很大的，而且问这个。这个业务肯定是不稳定的，是不是啊？在这里边，我们肯定是基于这种情况，为了减少各个服务器之间的这个偶合，我们服务器随着服务器动态增加服务器，而服务器挂掉。我们根本不用其他服务器去不断的检测这个挂掉服务器的状态，

以及新增加一个服务器啊，我要这新增加的服务器要跟所有的服务器直连，然后所有的服务器也要跟新增加的这个服务器直连，然后。他们中间建立这个心跳那么。整个的我们服务端这里边所发这个所发送的这个消息本身之间发送的是不是就很多啊？啊，你本身就占用了服务器的一定的资源，这服务器应该是把最大的资源留给客户端去处理，客户端的请求嘛。对不对？你为什么要让服务器来充当客户端的角色呢？连接其他服务器，这是什么骚操作啊？所以呢，

这就是我们消息队列产生的这个。必要性，我们进行跨服务器通信的时候，我们一般都是引入这个消息队列，用消息队列来解偶，各个服务器。他们的这个偶合程度啊。所有的这个服务器不需要感知其他服务器的存在。我只做好我本职工作，我充当一个我server就行了。对吧啊，这里边有服务器挂掉的话，那相当于不影响其他的这个服务，因为服务器跟服务器之间没有强偶合。它所有的服务器都是跟这个消息队列偶合的啊，

当你增加一台服务器的话，无也不需要别人都知道。你来了，你只需要也跟这个消息队列进行绑定就行了，你看从网络拓扑结构上是不是就整个的设计就非常的清晰了？那在这里边，你需要消费别的，就是你这个啊，一号服务器要消费，别的服务器啊，跨服务器给你转发的消息，你在这里边只需要。订阅一个。我们既定好的主题就行了。是不是订阅这个主题以后呢？

其他服务器啊，有需要转发到你的这个消息的话呢啊，那在这里边有需要。需要发布的消息的话，他直接往这个主题发布就行了，然后你订阅了这个主题，那么消息队列就会把这个主题上的消息推给你。而且我们消息队列刚说了它消息的消费啊，它是一个可靠的消费，它会保证啊，它会有一定的机制来保证你这个消。消息是绝对能够被你消费到的。而且只消费一次。好的吧啊，那么这里边你就可以直接画图嘛啊，

画图跟我刚才呢这样的解释去跟。面面试官去聊一聊。多动手多动手啊，多动手，通过动手来驱动动脑，我同学们。不要永远都是写代码，也是用眼睛盯着这个屏幕，对吧？好像盯着盯着我就能把那代码盯出来似的。我们永远是先有逻辑思路，然后再翻译成代码，我就不相信你把单词背的多，你英语就说的特别的好。没有这么一说吧。

是不是那语言要表达的好，知道在什么样的场景是说什么样的这个呃，合理的话，那是需要各种各样的经验的。你需要去经历的，你需要有一定的阅历的，你不能说我背了好多的单词，我把理论学好，我背了几遍课文，我就会说我在。合适的场景下啊，我就说英语就说的非常好了，这个根本就不可能的事情。是不是那同学们，你现在学语文学时间也？

也这个也不短了吧啊，现在去让你在一个几百人几千人的这个场合去给我做一个即兴的半个小时，一个小时的发言。啊，你能说你的语文学的不错，你发言你说话就能说的很好吗？不是的，同样的嘛，我计算机这个编程语言也是个语言，当我们大家在去做基试题。再去答笔试题，在面试的时候去给人家输出代码的时候，不要总是听完问题就用眼睛盯盯着屏幕，盯着纸，好像盯着盯着那代码就能盯出来似的。

我们一定啊，多动动手，多画一画，先把思路整理出来，有了思路，我们可以先写伪代码，把处理这个问题的步骤写下来，然后呢，我们有了逻辑思路，然后才会把这些逻辑思路转换成我们具体的。代码才能解决，是不是这样的？不可能，你写着写着把这个代码写着写着，整个思路就出来了，

那你只能是写十行删五行写20行删十行。啊，最后嘛，时间花费完了，也没见你写几行代码出来，甚至连一个代码题你也写不完。同样的，去解决这些场景是类的问题的时候，大家不要光用脑子在那想，其实你脑子只能是一个单线程啊，后边想想东西的时候，前边刚想过的可能都已经忘了。如果你脑子不能做到并发执行的话，我建议大家动动手，把你思考的东西在纸上画出来，

你画着画着就能看到哪些合理哪些不合理了。行不行啊？好，那这个问题呢？我们就给大大家嗯。啊，给出了一些解读啊，希望呢，同样的引起大家的一些思考啊，后边碰到这些问题的时候呢。而大家可以。有一个。回答问题的一个角度好吧，或者是方式啊，相关的这里边因为问题都比较多啊，

有的东西呢，我只是给大家从。从全局给大家说了一下，具体的你想了解一下，比如说每个mq它的性能有多强？它是不是支持数据的序列化啊？它使用的时候有什么需要注意的地方，那么这些东西大家都可以查一下，它的官网都有详细的一些说明文档的啊。好，那这节课我们就给大家说到这