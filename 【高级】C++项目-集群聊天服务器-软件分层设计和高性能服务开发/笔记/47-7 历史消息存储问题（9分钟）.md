那还有一个同学提出的消息就是面试的时候啊，面试官问他如果让你实现啊，历史消息存储的话。你是怎么设计的啊？对于这个问题来说的话。嗯，我不知道同学们觉得自己的这个困难点在哪里？还是不要慌啊，不要慌，我觉得我们同学们总是。找工作着急，良忙呢，这个把这个。呃，视频看完。

基本不响。哦，想的太少对吧啊，都不好好想一想，写到简历上的东西都不好好想一想，直接去面试，其实这种效果并不怎么好的，那这种问题我觉得是非常简单的啊。那你用QQ都用过很多了，那QQ本地消息是怎么存储的啊？消息是怎么存储？你可以仿照它去给一些思路就行了嘛。你比如说本地，你本地存储的话，你存储本地消息啊，

存储本地消息简单啊，你无非就是跟个人聊。或者是群聊嘛。对吧啊，你跟个人聊的话，你可以在你的这个本地的这个程序的目录里边一。这个好友的QQ号。作为什么作为文件夹？这个肯定是不会重复的吧啊，作为文件夹，也就是说呢，在这里边有很多的这个文件夹嘛。这很多的文件夹的话，你可以把你个人跟这个你相应好友的这个聊天消息就保存到啊，相应文件夹底下的。

文件里边就行了嘛，你这个保存你要保存到一个文件也可以，那消息越多是吧，我可以给消这个文件规定一个大小，比如说超过200M以后呢？就开始存储到下一个文件，或者说是你这文件直接按按什么按天存储？按天存储消息也可以呀。是吧啊，这个就是。细节实现了方法很多。对不对？这是直接存到文件里边的，当然你为了考虑安全性，我们可以在存储文件的时候呢。

给文件的内容做一个加密操作啊，这个密钥呢，我们就选用前面讲过的对称加密就可以了，密钥我们。就可以写一个。嗯，有好友的这个QQ号，或者再结合一个系统时间什么的啊，作为一个默认生成的一个密钥。在我们客户端里边生成就行了，我们直接进行一个加密，到时候呢？这个密钥我们要管理起来。好，到时候可以进行一个解密。

是不是啊？这样也可以，这是存到文件里边，另外的话就是存到这个。你要存到这个好搜索好查询对吧？你要直接存到文件里边，你不好搜索，不好查询。啊，查询一些历史消息，那你可以把这个存到这个，比如说数据库。circle let.circle得是一个。嵌入式数据库啊。

嵌入式数据库。也是一个关系型数据库。其实。操作方式上来说嗯，都是支持标准的circle，操作的就跟my circle一样，当然my circle是一个分布式数据库，因为它是设计成CS了。是不是啊？就是很多的my cld可以访问同一个my server circle类的，是嵌入到当前进程里边了。那也就是说呢，我们同学们可以在在这个客户端啊，根据你的这个。好友的QQ号或者是群聊的这个。

群号对吧啊？作为一个字段，然后这里边可以存储消息啊，把它存到一个。关系型数据库的表里边啊，都行的是不是这个表里边内容你也可以进行加密的啊？那么，具体什么circle语句，具体表怎么设计这个我们？就不用多说了啊，集群聊天服务器我们也设计表了，在my的这个核心讲解里边，我们也专门去说了表如何设计啊，如何拆分？呃circle如何写单表的多表的？

那么，这里边只是给出一些思路方法，你看这就是本地消息，存储云消息存储，也就是说呢，本地消息存储，那当然了，你只有在当前的这个本地这个计算机上。啊，登录你的账号才能看到你这些本地消息，你换个机器登录你的账号，那因为。这是本地存储的，你换个机器肯定是看不了的，对吧？

你想换个机器啊，换个移动设备也能看到你之前的聊天消息的话，那你这个消息就只能存在云上了，就是存在服务端了。是吧啊，存在服务端了，其实服务端存跟你客户端存没什么本质上的区别，不服务端存的话，那就是。涉及怎么存的啊？首先这个聊天消息，大家从业务上想一想啊，如果存在这个。云消息存储。首先，

这个历史消息查看的频率大不大？这个应该是不大的吧，首先不大的话，我们就不需要把它存在什么red is，就像是缓存数据库里边来。这个提升它的访问效率的，没有必要因为这个业务根本涉及不到这个啊，这个这个低延时高并发的访问。是吧啊，存到my里边行不行啊？存到my s里边。嗯，也可以，那你可以专门搞一个服务器呢，专门运行matlab存这个历史的这个云消息行。

对吧啊行。那么，这是没有问题的，而且SQL呃MySQL呢？关于型数据库本身就是支持高效的，这个SQL查询的我们。对于云消息，要进行消息搜索，消息关键字过滤的话也非常的是不是方便啊啊？那比如说历史比较悠久的这些。消息呢，就是已经半年前的或者一年前的消息，我们其实可以把这些因为你不能把所有的消息都往my里边堆呀，my的单表基本上它的上限也就是。嗯，

千万行吧啊，过千万行以后呢，他my circle整个表的你就是创建索引是由于索引文件特别特别大，导致读索引花费的磁盘l次数也特别多。所以效率也是非常慢的啊，所以如果说是我们这消息不断的都往my里边存，随着消息越来越多，时间越来越久，my肯定是越来越慢，甚至呢，到最终都能挂掉。所以我们会把一些超时间限制为半年前的，一年前的这些消息给它，从matlab里边dump出来。给它放到哪里去啊？

给它放到专门的一个file server上，就是文件服务器上啊，进行一个磁盘存储文件的一个。序列化存储。呃，因为这些数据，毕竟它不是经常访问的嘛。OK吧啊，这就存到云端，存到云端以后呢，我们换设备，换机器，再登录的时候你拉的消息都是从服务端了。跟你客户端在哪个机器上登录，没有直接的关系的。

这个问题不复杂，我在这里边就提示到这就行了，好的吧啊，那在这里边可能就是这个问题，主要考察的就是。嗯，因为你们没实现这个功能，可能就考察，一是你的现场的一个思维逻辑能力。想出一种解决方案。在这看你表述方案的时候，逻辑性是否合理，而不是说说说了半天啊，别人也听不清楚，你自己也讲不清楚。

第三个就是数据怎么存？因为我们有一对一的聊群聊数据怎么存？怎么划分是文件存储还是数据库存储？文件存储OK数据库存储方便，是不是进行各种各样circle的查询啊？那对外在业务上体现，就是可以支持非常方便的查询了，如果是文件存储，我们要进行查询的话，那我们就只能是把文件读出来再。读读出来，把文件的内容读出来，读到内存上，然后在内存上再用关键字进行一个过滤。是不是嗯？

好，那在这里边包括云消息存储是放red is缓存数据库，还是放在我们磁盘数据库，或者是我们放在文件直接存储成文件？啊，这个我们是基于什么考虑的对吧啊？那给大家就提点到这里，希望同样的引起大家的一些思考对于。将来如果你也被问到这个问题的话啊，希望你能够。回答的全面啊，好一点啊。