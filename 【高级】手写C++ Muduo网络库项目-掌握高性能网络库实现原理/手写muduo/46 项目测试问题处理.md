这节课呢，我们给大家。把上节课我们在测试我们这个网络库代码的时候呢，所遇到的问题那个错误呢，给大家来说一下。很明显，在运行的过程中呢，我们的日志帮了大忙。从日志的打印可以看到是这个。handle red这里边出现了错误，而且我们打印了这个l number是个22，我们查看了一下22的这个错误的原因。主要是因为呢invalid argument对吧？这个connect这个非法，那我们进到这个accept里边很明显在这里边啊，

我们隐含了错误。但是当时写的时候呢，并没有注意，不知道大家在当时写这个函数的时候呢，面对所出现的问题。有没有？唉，这个当时有没有看出来呢啊？如果看出来了，你可能已经修改了，如果没有看出来，在这里边呢？跟我一起把代码修改一下，在这里边呢，我们出现了两个问题啊，

两个问题，第一个问题呢就是。accept accept函数。的参数不合法，这我们是通过人家的提示看出来的，对吧？第二个就是。对返回的这个。connect fd.没有设置。什么呀，没有设置非阻塞。对吧啊，没有设置这个非阻塞。呃，

在这里边呢，我们都来处理一下。首先呢，accept这个。函数啊，大家来跟我看一下啊。不是这个。okay.大家来看啊，跟我看这个第三个参数啊，第三个参数accept。the addr len argument is a value result argument，它是一个输出参数啊。the caller must initialize it，调用者必须对这个addr论。

进行一个初始化it to contain。初始化什么呢？the size啊，这个按字节of the structure pointed to by a ddr。没问题吧啊，那在这里边也就是说人家都已经说明了啊，当我们传这个参数的时候呢，是需要去初始化。一个大小的。初始化谁的大小呢？就是这addr的大小。好不好？好，否则的话在这里边呢，人家是给我们已经强调了，

所以我们一定得照做，否则的话就会出现一些不可预期的错误。啊，对不对啊？这就是我们所谓的invalid argument。这个问题呢，我们修改一下好吧？第二个就是。我们说了，我们整个的这个服务器所采模型呢就是。其余。多线程的这个reactor模型。reactor模型，典型的reactor模型有多个loop，one loop。

是。thread对吧啊？而且呢，每一个什么里边啊？每一个这个。loop啊，每一个loop里边呢，所采用的都是一个polo。就是l复用加上一个n。blocking IO.好吧啊，但是这里边呢，我们并没有设置，是不是实际上呢？在人家的这个源码库里边啊，

人家对于这个accept。人家做了一层封装，实际上这个accept里边，你看如果用简单的accept在这里边专门用and close on exec。对于我们的connect ft进行了一下这个模式的修改。通过系统调用fcntl先获取呢，当前这个文件描述符本身的一些标志flag，然后再给它。这个或上谁啊？number block设置成非阻塞，然后再给它添加close exec标志。没问题吧啊，那么我们现在有这个新的方法，就是accept 4在这里边，大家看一下它相当于它相对于accept多了一个参数flag。

这个flag就是跟我们的这个创建socket的那个新的，这个socket的方法一样啊。就是可以直接给我们创建的这个socket返这个返回的这个connect fd来添加相应的标志，你看刚好就是支持这两个一般。啊，我们用的比较多的。in the in the in the same as except,the following values can be.哎，多了就是可以。给我们的connect fd设置这样的一个标志。对吧啊，从人家的这个源码库上，我们也可以看到，当时我们是在调用的地方，

直接写了accept，并没有点进来，仔细的去看一下啊。好，那在这里边，我们修改一下吧。这又是我们在。写这个项目的时候遇到的相应的这些问题啊。我们改成accept 4。然后呢，最后有一参数。sock n block.sock gloss exec把这两个标志呢，我们给它。加上好吧唉，

加上OK，那我们把根据呢问题的现象。我们到了这个accept这里边，发现了这两个问题啊，好，我们修改一下。修改一下，然后呢？重新我们重新去构建一下啊。速度点杠auto build。输入密码。开始我们的编译安装。这里边儿因为源码稍微有点多，所以编译花了一小。小几秒的时间啊。

那么在这儿呢，我们相当于安装成功了是吧？安装成功了以后呢？那接着就进入我们的example。clean一下啊。重新make啊。好，重新make生成我们的test server。test server.okay，这里边。我们看到也确实是启动成功了。在测试幺二七点零点零点一八千这个端口。hello，这是个回响服务器。

这个服务端给返回以后呢，就直接。沙尔档掉了对吧啊？这个是符合我们预期的，再来看。okay.正常。这都是正常的，对吧？不发数据直接退出。quit,okay?这都是可以正常工作的，对不对？还没有出现什么问题。

我们。先连接上。可以复制绘画。多连接几个。telnet幺二七点零点零点一八千。哎，这两个应该是都是没啥问题的哈。OK，那这个测试工作我们就做到这里了，大家可以进行更详细的一些测试，如果你有发现什么问题的话，可以根据我们的这个日志。啊，根据我们的这个日志。来看有没有什么错误，

然后定位到相应的这个代码中去啊？啊，如果能够独立解决问题是最好，如果经过自己详细的分析，依然是发现不了问题的所在啊。那么，大家可以来。问我啊，大家可以来在QQ上来咨询相应的这个问题啊。好，那我把这个。服务器的程序我就关掉了。那么，到目前来看，我们整个的这个。

网络库啊，我们自己照着这个model库。写的这个网络库，实际上啊，大家完全可以把这个作为独立的项目，为什么因为诶这个跟莫洛库本身呢？差别还是挺大的，那么核心的这个网络设计模型是没有变的，那首先一是最大的问题就是。最大好处就是脱离了boost库。在安装model库的时候呢，不用再安装繁琐的这个boost库了，我的所有的依赖于boost库全部切换成CA加幺幺了。也就是说model库现在。你要去使用的话，

只需要直接怎么样啊？这个执行这编译脚本，然后安装把相应的头文件跟编译的so库装到这个系统目录里边，直接就可以使用了。这是非常的这个简单方便的。对不对啊？非常的简单方便。那么好了。到我们课堂上，我们发这个给大家进行功能测试，发现的这个问题就解决到这里啊呃，大家呢？希望在研究的过程中。再把这个代码去梳理梳理啊，有问题的话解决一下，

如果。独立解决不了的话呢，可以在QQ上群里边来。咨询相应的一些问题，描述清楚啊。好，那这节课我们就给大家说到这里。