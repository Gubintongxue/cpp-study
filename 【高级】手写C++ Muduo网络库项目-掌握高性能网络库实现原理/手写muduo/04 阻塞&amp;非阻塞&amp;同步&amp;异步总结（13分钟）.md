# 阻塞 非阻塞 同步 异步 总结

## 回答面试

啊，这节课呢，我们的内容很简单，就是呢，我作为一个面试者，当我被问到，让我去解释了阻塞非阻塞，同步跟异步的时候呢，

我的一种回答方式啊，大家可以作为一个参考。呃，也并不是说是这个世界上最正确的答案，对吧啊

最标准的答案，我不能这么说啊，但是呢，对于大部分的同学来说，我们希望总结一套啊，还是比较不错的，这么一个参考答案好吧啊，

希望大家呢，能够在我的基础上能不能够更更加丰富呃一下？呃，自己对于这个问题的一个回答。那么，如果我被问到这个问题呢？

## 参考回答

### 网络IO的两个阶段

那我首先的阐述应该就是阻塞非阻塞，同步异步啊，它描述的都是lO的一些状态。

一个典型的网络IO，它包含两个阶段。数据就绪或者数据准备, 和数据读写。

我们在去面试的时候，再去这个阐述理论问题的时候，我们尽量把它往实践的意义上靠。

不要总是在飘在理论这个回答过程中，理论越说越虚，越说越虚，对吧？

我相信你跟人家面试官玩理论，你肯定玩不过人家的。

啊，往你自己的实践意义上，靠平时写项目啊，写代码啊，你都有很多的实践，对吧啊？

网络lO有数据就绪，跟数据读写。

### 举例

那在这里边，比如说我举个例子啊receive对吧啊，

### 同步IO

比如说在这里边receive我传一个sock fd。传一个buf的大小。

是不是啊？那这个数据就绪就是说呢，远端有没有数据过来就是内核的相应的socket fd？

对应的这个TCP接收缓冲区是否有数据可读？当这个socket fd当这个lO工作在这个阻塞模式下的话。

那么，当我调用receive的时候呢？

如果数据没有就绪啊，receive是会阻塞当前的这个线程的。

如果说这个socket fd是公路在非阻塞状态下的话呢？

当我去调用这个系统IO接口，这个receive的时候呢？它是会立即返回的啊。

那我怎么判断它的这个非阻塞状态呢？

是由于没有收到数据，而不是由于连接有问题呢？

返回值返回值负一的话就表示连接出现问题，连接异常了。连接中断了，对吧？

返回值如果是0 size是零，而且error number是一个eagain或者一五的block的话。啊eagain跟一五的block

是一个意思对吧？那就表示呢，它是一个正常的非阻塞这个IO的一个返回数据未就绪。

这就解释了阻塞跟非阻塞。



那在这里边，如果说数据就绪了，远端有数据过来了，数据准备好了。

那开始进行读写了，那还是以刚才的例子来，那在这里边receive。

会继续，那么我们应用层调用receive这个接口呢？会继续自己应相当于花应用程序自己的时间把这个数据从这个内核的TCP接收缓冲区拷贝到我给receive传的这个buffer应用程序缓冲区当中。

拷贝数据的过程中。我们应用程序是一直等待这个数据拷贝完成以后receive才返回的。

就像我刚才在课程上给大家说的a会一直等待这个b操作完成啊，他把这个数据从b搬到a，就是从操作系统的这个内核缓冲区搬到这个应用程序的缓冲区以后。

这个应用程序在自己向后走。对吧啊，

### 异步IO

如果呢是一个异步lO的话呢啊，当我去调用这个异步lO接口的时候系统给我提供的异步lO接口的时候呢啊，我一般呢不会像我刚才定位receive那么简单。

对吧，只传一个这个sock。只传一个buffer，是不是就完了啊？



我需要传一个socket fd，这个是对应的一个tcb缓冲区，从远端接收数据的，还有一个buffer就是我要最终如果有数据的话呢，我要把这个内核缓冲区的数据搬到应用程序的每一块儿缓冲区当中，还有一个就是通知方式。这是非常重要的一个异步的一个特点。

我可以通过信号，可以通过回调来告诉呢，这个操作系统的100欧。



是不是到时候呢？你负责帮我监听这个socket fd上是否有数据可读，有的话你帮我把数据从内核的TCP缓冲区搬到。我给你传到buf里边，

你最后再通过咱俩事先约定好的通知方式来通知我应用程序，

我应用程序就可以处理你这件事情了，而且我数据已经拿到手了。这就是异步。

当然，我们在这里边说的举例子的用的都调用的都是系统的IO接口，所以我在这里边阐述的主要都是系统的IO同步跟异步，

### 业务的并发的同步和异步

实际上在我们专门聊这个项目，

聊这个应用程序的业务开发的时候，我们也会说到。业务层面的并发的同步跟异步。

虽然呢，聊的这个角度不一样，但是实际上它的核心原理都是一样的，



同步就是我a操作对吧啊，要调用b操作的API接口的时候，是不是啊？

我是一直在等待。b完成以后给我返回，我拿到返回值。a继续操作。



而异步是什么呢？

异步就是我a告诉b我对什么事件感兴趣啊，并且呢，我把希望你最终通知我的方式呢，我告诉你。

当你这个b接收到这个监听到这个事件发生以后，监听到什么事件呢？就是我a感兴趣的事件以后。

你用我a跟b事先约定好的通知方式，你来通知a你感兴趣的事件发生了，你去处理吧。



对吧啊，一般在业务层面呢，我们经常会通过回调的方式来。实现a告诉b。

到时候怎么通知我去处理相应的，我感兴趣的事件。好吧啊，那我的这个描述方式就是这样的。



### 重述一遍 参考答案

主要分这几步骤啊，

### IO的两阶段

首先呢，我从一次网络IO的两个阶段开始说的。数据就绪跟数据读写。

### 阻塞和非阻塞

啊，是不是啊？在这里边，我说的时候呢，我提到了一个receive一个lO接口，或者是你用read，对吧啊？

你调用了系统那个IO接口啊，在监听socket fd的时候呢，这个fd是默认的阻塞，或者你设置成非阻塞的情况下呢？

它的一个表现形式是什么？对吧啊，对于receive和read的一个表现形式是什么？

### 表现形式

这一点表现形式说完以后呢？啊，那这个阻塞跟非阻塞，你就介绍完了，

### 同步

接着你就是介绍同步跟异步，

对吧？同样的啊，receive就是一个同步的一个lO接口。

那数据这个内核的TCP缓冲区数据准备好了以后呢？

如果是已调用同步的这个receive lO接口的话。

嗯，那是怎么做的？

### 异步

然后呢？再说异步跟同步的方式不一样啊，不一样在哪儿？

首先呢，我们利用linux的这个系统的这个异步的lO操作就是这个al read跟aio write，



我们需要给它一些什么东西？哎，通知通知，

==这是不是跟调用同步lO接口不一样的地方==。

然后呢？他要在这死等在这个接口上，是不是等待这个数据完成啊啊？

### 同步IO

因为他不操心这些数据，谁操心这些数据呢？又没有人通知他对不对？你是同步的嘛啊，所有的这个数据的搬运。

是不是数据是否搬运完成都得你调用方，你应用程序你自己操心啊。

### 异步IO

而我异步就不一样了，我异步把该给你的都给你，唉，协商好通知方式，我就可以自己玩自己的了，

到时候所有的我感兴趣的操作数据都读完,以后准备好以后呢，

你直接用我们事先约定好的方式通知我就行了，我直接睁开眼睛就可以处理数据了。

就在这一套监听数据发生，数据是否就绪？数据的这个读写就数据的搬运。

我根本不花费我应用程序，任何的时间。都是你这个通过调用异步lO接口来帮我实现的。

当我得到通知的时候呢，这数据已经搬运完了，我直接操作数据就可以了。





希望同学们在这里边把这个搞清楚，最后呢，我举的例子调用的都是系统的这些lO接口嘛。

对吧啊，像aio read aio write，receive read这些都是系统IO接口。

当然呢，我们在业务层面呢，在实现一些业务逻辑的时候，

### 业务实操中的同步和异步

也会聊到同步跟异步，

哎，同学，你这个操作呢，是同步实现呢，还是异步实现？

==对吧啊，你这个登录呢，是同步实现的还是异步实现？你这个注册啊，你这个用户的激活是同步实现的还是异步实现的？==

### 多人注册等是同步  我自己关系的

这就是我们在聊业务。业务的同步跟异步并发的同步跟异步。

对不对啊？我多个人登录，多个人注册，

你响应你这个鉴别用户的合法性，对吧？

这些是同步还是异步的啊？实际上是一样同步的操作，都是在自己操心这个事情是否完成啊？

这个事情的这个完成全部花费在我同步调用接口的身上了啊，



而异步呢，就是纯粹我告诉你，我感兴趣的事件，以及通知方式。你到时候做完了通知我就行了，我直接处理我感兴趣的事件数据就可以了。

好吧啊，我就是从这几方面来回答这个问题的。



啊，我觉得最大的特点就是说清楚了，有哪几点？

对吧，有哪些场景啊，也都比较全面，

而且我们最重要的是理论结合了实践。

并不是说是没有任何的这个实践意义对吧啊，这个空口白牙在那乱说是不是啊？



希望同学们呢？在这里边我啊，我刚刚回答的这些参考答案里边呢，自己采取总结一下，因为我给大家说的时候是一边说一边解释。

希望大家呢，能留下最精华的东西。好吧啊。

陈硕大神的原话非常精简，也给大家贴到这里边儿了，

希望大家通过这几节课的学习，能够真真正正的搞定阻塞，非阻塞同步跟异步的概念。好吧啊，

如果呢？有什么样学习上的问题的话，欢迎大家在QQ上进行一个咨询啊，我们。这一节课的内容就说到这里。